<script src="http://10.32.2.21:8080/application.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" charset="utf-8">
    var jugAvailables = new Juggernaut();
    var jugCalled = new Juggernaut();

    $("#mesg").append($("<li/>").append("Subscribing to channel1_channel2"));

    jugAvailables.subscribe('availables', function(data){
        $("#tickets").append('<tr id='+data.id+'><td>'+data.value+'</td><td><a id='+data.id+" class='trigger_submit'> Chamar</a></td></tr>");
    }); 

   jugCalled.subscribe('calleds', function(data){
        $("tr#"+data.id).remove();
    }); 
</script>
<h1><%= t('model.wicket.tickets.call') %></h1>

<input id="current" type="hidden" />

<input id="call_next" type="button" value='<%= t('model.call') %>' />
<input id="pending" type="button" value='<%= t('model.ticket.pending') %>' />
<input id="recall" type="button" value='<%= t('model.ticket.recall') %>' />

<%= form_for( CallHistory.new ) do |f| %>
  <%= f.hidden_field :ticket_id %>
  <%= f.hidden_field :wicket_id, :value => params[:wicket_id] %>
  <table id="tickets">
    <tr>
      <th><%= t('model.ticket.name') %></th>
      <th></th>
    </tr>
  <% @tickets.each do |ticket| %>
    <tr id='<%= ticket.id %>'>
      <td><%= ticket.value %></td>
      <td><%= ticket.updated_at.strftime( t('time.formats.hour_minute') )%></td>
    </tr>
  <% end %>
  </table>

  <table id="tickets_called">
    <tr>
      <th><%= t('model.ticket.called') %></th>
      <th></th>
    </tr>
    <% if @tickets_called %>
      <% @tickets_called.each do |ticket| %>
        <tr>
          <td><%= ticket.ticket.value %></td>
          <td><%= ticket.ticket.updated_at.strftime( t('time.formats.hour_minute') )%></td>
        </tr>
      <% end %>
    <% end %>
  </table>

  <table id="tickets_waiting">
    <tr>
      <th><%= t('model.ticket.pending') %></th>
      <th></th>
    </tr>
    <% if @tickets_waiting %>
      <% @tickets_waiting.each do |ticket| %>
        <tr>
          <td><%= ticket.ticket.value %></td>
          <td><%= ticket.ticket.updated_at.strftime( t('time.formats.hour_minute') )%></td>
        </tr>
      <% end %>
    <% end %>
  </table>

<% end %>
